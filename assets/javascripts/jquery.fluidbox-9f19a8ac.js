!function(t,e){var i=function(t,e,i){var o;return function(){function n(){i||t.apply(a,r),o=null}var a=this,r=arguments;o?clearTimeout(o):i&&t.apply(a,r),o=setTimeout(n,e||100)}};jQuery.fn[e]=function(t){return t?this.bind("resize",i(t)):this.trigger(e)}}(jQuery,"smartresize"),function(t){t.fn.fluidbox=function(e){var i=t.extend(!0,{viewportFill:.95,overlayColor:"rgba(255,255,255,.85)",debounceResize:!0,closeTrigger:[{selector:"#fluidbox-overlay",event:"click"}]},e);t("<div />",{id:"fluidbox-overlay",css:{"background-color":i.overlayColor}}).appendTo("body");var o,n=this,a=t(window),r=function(){t(".fluidbox-opened").trigger("click")},s=function(t){var e=t.find("img"),i=t.find(".fluidbox-ghost"),o=a.scrollTop()-e.offset().top+.5*e.data("imgHeight")*(e.data("imgScale")-1)+.5*(a.height()-e.data("imgHeight")*e.data("imgScale")),n=.5*e.data("imgWidth")*(e.data("imgScale")-1)+.5*(a.width()-e.data("imgWidth")*e.data("imgScale"))-e.offset().left,r=e.data("imgScale");i.css({transform:"translate("+parseInt(10*n)/10+"px,"+parseInt(10*o)/10+"px) scale("+parseInt(1e3*r)/1e3+")"})},l=function(){o=a.width()/a.height(),n.each(function(){var e=t(this).find("img"),n=t(this).find(".fluidbox-ghost"),r=t(this).find(".fluidbox-wrap"),s=e.data();s.imgWidth=e.width(),s.imgHeight=e.height(),s.imgRatio=e.width()/e.height(),n.css({width:e.width(),height:e.height(),top:e.offset().top-r.offset().top,left:e.offset().left-r.offset().left}),s.imgScale=o>s.imgRatio?a.height()*i.viewportFill/e.height():a.width()*i.viewportFill/e.width()})};return i.closeTrigger&&t.each(i.closeTrigger,function(e){"window"!=i.closeTrigger[e].selector?t(document).on(i.closeTrigger[e].event,i.closeTrigger[e].selector,r):a.on(i.closeTrigger[e].event,r)}),n.imagesLoaded().done(function(){n.each(function(){t(this).is("a")&&1===t(this).children().length&&t(this).children().is("img")&&t(this).addClass("fluidbox").wrapInner('<div class="fluidbox-wrap" />').find("img").css({opacity:1}).after('<div class="fluidbox-ghost" />')}),l();var e=function(){l();var e=t("a[data-fluidbox].fluidbox-opened");e.length>0&&s(e)};i.debounceResize?t(window).smartresize(e):t(window).resize(e),n.click(function(e){var i=t(this),o=t(this).find("img"),n=t(this).find(".fluidbox-ghost");if(0!==t(this).data("fluidbox-state")&&t(this).data("fluidbox-state"))t(this).data("fluidbox-state",0).removeClass("fluidbox-opened").addClass("fluidbox-closed"),t("#fluidbox-overlay").fadeOut(),n.css({transform:"translate(0,0) scale(1)"}).one("webkitTransitionEnd MSTransitionEnd oTransitionEnd otransitionend transitionend",function(){n.css({opacity:0}),o.css({opacity:1})});else{t(this).data("fluidbox-state",1).removeClass("fluidbox-closed").addClass("fluidbox-opened"),t("#fluidbox-overlay").fadeIn(),n.css({"background-image":"url("+o.attr("src")+")",opacity:1}),o.css({opacity:0});var a=new Image;a.onload=function(){n.css({"background-image":"url("+i.attr("href")+")"})},a.src=t(this).attr("href"),s(t(this))}e.preventDefault()})}),n}}(jQuery);