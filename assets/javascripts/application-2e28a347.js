// copyright chris wanstrath
function randFromTo(t,e){return Math.floor(Math.random()*(e-t+1))+t}function isCollide(t,e,n){var n=n?n:0,i=t.offset().top,o=t.offset().left,a=e.offset().top,r=e.offset().left;return!(i+t.height()+n<a||i-n>a+e.height()||o+t.width()+n<r||o-n>r+e.width())}!function(t){function e(e,i,o){var a=this;return this.on("click.pjax",e,function(e){var r=t.extend({},f(i,o));r.container||(r.container=t(this).attr("data-pjax")||a),n(e,r)})}function n(e,n,i){i=f(n,i);var a=e.currentTarget;if("A"!==a.tagName.toUpperCase())throw"$.fn.pjax or $.pjax.click requires an anchor element";if(!(e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||location.protocol!==a.protocol||location.hostname!==a.hostname||a.hash&&a.href.replace(a.hash,"")===location.href.replace(location.hash,"")||a.href===location.href+"#")){var r={url:a.href,container:t(a).attr("data-pjax"),target:a},s=t.extend({},r,i),c=t.Event("pjax:click");t(a).trigger(c,[s]),c.isDefaultPrevented()||(o(s),e.preventDefault())}}function i(e,n,i){i=f(n,i);var a=e.currentTarget;if("FORM"!==a.tagName.toUpperCase())throw"$.pjax.submit requires a form element";var r={type:a.method.toUpperCase(),url:a.action,data:t(a).serializeArray(),container:t(a).attr("data-pjax"),target:a};o(t.extend({},r,i)),e.preventDefault()}function o(e){function n(e,n){var o=t.Event(e,{relatedTarget:i});return s.trigger(o,n),!o.isDefaultPrevented()}e=t.extend(!0,{},t.ajaxSettings,o.defaults,e),t.isFunction(e.url)&&(e.url=e.url());var i=e.target,a=d(e.url).hash,s=e.context=p(e.container);e.data||(e.data={}),e.data._pjax=s.selector;var c;e.beforeSend=function(t,i){return"GET"!==i.type&&(i.timeout=0),t.setRequestHeader("X-PJAX","true"),t.setRequestHeader("X-PJAX-Container",s.selector),n("pjax:beforeSend",[t,i])?(i.timeout>0&&(c=setTimeout(function(){n("pjax:timeout",[t,e])&&t.abort("timeout")},i.timeout),i.timeout=0),e.requestUrl=d(i.url).href,void 0):!1},e.complete=function(t,i){c&&clearTimeout(c),n("pjax:complete",[t,i,e]),n("pjax:end",[t,e])},e.error=function(t,i,o){var a=g("",t,e),s=n("pjax:error",[t,i,o,e]);"GET"==e.type&&"abort"!==i&&s&&r(a.url)},e.success=function(i,c,u){var f="function"==typeof t.pjax.defaults.version?t.pjax.defaults.version():t.pjax.defaults.version,p=u.getResponseHeader("X-PJAX-Version"),h=g(i,u,e);if(f&&p&&f!==p)return r(h.url),void 0;if(!h.contents)return r(h.url),void 0;o.state={id:e.id||l(),url:h.url,title:h.title,container:s.selector,fragment:e.fragment,timeout:e.timeout},(e.push||e.replace)&&window.history.replaceState(o.state,h.title,h.url),document.activeElement.blur(),h.title&&(document.title=h.title),s.html(h.contents);var m=s.find("input[autofocus], textarea[autofocus]").last()[0];if(m&&document.activeElement!==m&&m.focus(),v(h.scripts),"number"==typeof e.scrollTo&&t(window).scrollTop(e.scrollTo),""!==a){var x=d(h.url);x.hash=a,o.state.url=x.href,window.history.replaceState(o.state,h.title,x.href);var w=t(x.hash);w.length&&t(window).scrollTop(w.offset().top)}n("pjax:success",[i,c,u,e])},o.state||(o.state={id:l(),url:window.location.href,title:document.title,container:s.selector,fragment:e.fragment,timeout:e.timeout},window.history.replaceState(o.state,document.title));var f=o.xhr;f&&f.readyState<4&&(f.onreadystatechange=t.noop,f.abort()),o.options=e;var f=o.xhr=t.ajax(e);return f.readyState>0&&(e.push&&!e.replace&&(x(o.state.id,s.clone().contents()),window.history.pushState(null,"",u(e.requestUrl))),n("pjax:start",[f,e]),n("pjax:send",[f,e])),o.xhr}function a(e,n){var i={url:window.location.href,push:!1,replace:!0,scrollTo:!1};return o(t.extend(i,f(e,n)))}function r(t){window.history.replaceState(null,"","#"),window.location.replace(t)}function s(e){var n=e.state;if(n&&n.container){if(T&&k==n.url)return;if(o.state.id===n.id)return;var i=t(n.container);if(i.length){var a,s=S[n.id];o.state&&(a=o.state.id<n.id?"forward":"back",w(a,o.state.id,i.clone().contents()));var c=t.Event("pjax:popstate",{state:n,direction:a});i.trigger(c);var l={id:n.id,url:n.url,container:i,push:!1,fragment:n.fragment,timeout:n.timeout,scrollTo:!1};s?(i.trigger("pjax:start",[null,l]),n.title&&(document.title=n.title),i.html(s),o.state=n,i.trigger("pjax:end",[null,l])):o(l),i[0].offsetHeight}else r(location.href)}T=!1}function c(e){var n=t.isFunction(e.url)?e.url():e.url,i=e.type?e.type.toUpperCase():"GET",o=t("<form>",{method:"GET"===i?"GET":"POST",action:n,style:"display:none"});"GET"!==i&&"POST"!==i&&o.append(t("<input>",{type:"hidden",name:"_method",value:i.toLowerCase()}));var a=e.data;if("string"==typeof a)t.each(a.split("&"),function(e,n){var i=n.split("=");o.append(t("<input>",{type:"hidden",name:i[0],value:i[1]}))});else if("object"==typeof a)for(key in a)o.append(t("<input>",{type:"hidden",name:key,value:a[key]}));t(document.body).append(o),o.submit()}function l(){return(new Date).getTime()}function u(t){return t.replace(/\?_pjax=[^&]+&?/,"?").replace(/_pjax=[^&]+&?/,"").replace(/[\?&]$/,"")}function d(t){var e=document.createElement("a");return e.href=t,e}function f(e,n){return e&&n?n.container=e:n=t.isPlainObject(e)?e:{container:e},n.container&&(n.container=p(n.container)),n}function p(e){if(e=t(e),e.length){if(""!==e.selector&&e.context===document)return e;if(e.attr("id"))return t("#"+e.attr("id"));throw"cant get selector for pjax container!"}throw"no pjax container for "+e.selector}function h(t,e){return t.filter(e).add(t.find(e))}function m(e){return t.parseHTML(e,document,!0)}function g(e,n,i){var o={};if(o.url=u(n.getResponseHeader("X-PJAX-URL")||i.requestUrl),/<html/i.test(e))var a=t(m(e.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0])),r=t(m(e.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]));else var a=r=t(m(e));if(0===r.length)return o;if(o.title=h(a,"title").last().text(),i.fragment){if("body"===i.fragment)var s=r;else var s=h(r,i.fragment).first();s.length&&(o.contents=s.contents(),o.title||(o.title=s.attr("title")||s.data("title")))}else/<html/i.test(e)||(o.contents=r);return o.contents&&(o.contents=o.contents.not(function(){return t(this).is("title")}),o.contents.find("title").remove(),o.scripts=h(o.contents,"script[src]").remove(),o.contents=o.contents.not(o.scripts)),o.title&&(o.title=t.trim(o.title)),o}function v(e){if(e){var n=t("script[src]");e.each(function(){var e=this.src,i=n.filter(function(){return this.src===e});if(!i.length){var o=document.createElement("script");o.type=t(this).attr("type"),o.src=t(this).attr("src"),document.head.appendChild(o)}})}}function x(t,e){for(S[t]=e,E.push(t);C.length;)delete S[C.shift()];for(;E.length>o.defaults.maxCacheLength;)delete S[E.shift()]}function w(t,e,n){var i,o;S[e]=n,"forward"===t?(i=E,o=C):(i=C,o=E),i.push(e),(e=o.pop())&&delete S[e]}function b(){return t("meta").filter(function(){var e=t(this).attr("http-equiv");return e&&"X-PJAX-VERSION"===e.toUpperCase()}).attr("content")}function y(){t.fn.pjax=e,t.pjax=o,t.pjax.enable=t.noop,t.pjax.disable=j,t.pjax.click=n,t.pjax.submit=i,t.pjax.reload=a,t.pjax.defaults={timeout:650,push:!0,replace:!1,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20,version:b},t(window).on("popstate.pjax",s)}function j(){t.fn.pjax=function(){return this},t.pjax=c,t.pjax.enable=y,t.pjax.disable=t.noop,t.pjax.click=t.noop,t.pjax.submit=t.noop,t.pjax.reload=function(){window.location.reload()},t(window).off("popstate.pjax",s)}var T=!0,k=window.location.href,$=window.history.state;$&&$.container&&(o.state=$),"state"in window.history&&(T=!1);var S={},C=[],E=[];t.inArray("state",t.event.props)<0&&t.event.props.push("state"),t.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]|WebApps\/.+CFNetwork)/),t.support.pjax?y():j()}(jQuery),function(t,e){var n=function(t,e,n){var i;return function(){function o(){n||t.apply(a,r),i=null}var a=this,r=arguments;i?clearTimeout(i):n&&t.apply(a,r),i=setTimeout(o,e||100)}};jQuery.fn[e]=function(t){return t?this.bind("resize",n(t)):this.trigger(e)}}(jQuery,"smartresize"),function(t){t.fn.fluidbox=function(e){var n=t.extend(!0,{viewportFill:.95,overlayColor:"rgba(255,255,255,.85)",debounceResize:!0,closeTrigger:[{selector:"#fluidbox-overlay",event:"click"}]},e);t("<div />",{id:"fluidbox-overlay",css:{"background-color":n.overlayColor}}).appendTo("body");var i,o=this,a=t(window),r=function(){t(".fluidbox-opened").trigger("click")},s=function(t){var e=t.find("img"),n=t.find(".fluidbox-ghost"),i=a.scrollTop()-e.offset().top+.5*e.data("imgHeight")*(e.data("imgScale")-1)+.5*(a.height()-e.data("imgHeight")*e.data("imgScale")),o=.5*e.data("imgWidth")*(e.data("imgScale")-1)+.5*(a.width()-e.data("imgWidth")*e.data("imgScale"))-e.offset().left,r=e.data("imgScale");n.css({transform:"translate("+parseInt(10*o)/10+"px,"+parseInt(10*i)/10+"px) scale("+parseInt(1e3*r)/1e3+")"})},c=function(){i=a.width()/a.height(),o.each(function(){var e=t(this).find("img"),o=t(this).find(".fluidbox-ghost"),r=t(this).find(".fluidbox-wrap"),s=e.data();s.imgWidth=e.width(),s.imgHeight=e.height(),s.imgRatio=e.width()/e.height(),o.css({width:e.width(),height:e.height(),top:e.offset().top-r.offset().top,left:e.offset().left-r.offset().left}),s.imgScale=i>s.imgRatio?a.height()*n.viewportFill/e.height():a.width()*n.viewportFill/e.width()})};return n.closeTrigger&&t.each(n.closeTrigger,function(e){"window"!=n.closeTrigger[e].selector?t(document).on(n.closeTrigger[e].event,n.closeTrigger[e].selector,r):a.on(n.closeTrigger[e].event,r)}),o.imagesLoaded().done(function(){o.each(function(){t(this).is("a")&&1===t(this).children().length&&t(this).children().is("img")&&t(this).addClass("fluidbox").wrapInner('<div class="fluidbox-wrap" />').find("img").css({opacity:1}).after('<div class="fluidbox-ghost" />')}),c();var e=function(){c();var e=t("a[data-fluidbox].fluidbox-opened");e.length>0&&s(e)};n.debounceResize?t(window).smartresize(e):t(window).resize(e),o.click(function(e){var n=t(this),i=t(this).find("img"),o=t(this).find(".fluidbox-ghost");if(0!==t(this).data("fluidbox-state")&&t(this).data("fluidbox-state"))t(this).data("fluidbox-state",0).removeClass("fluidbox-opened").addClass("fluidbox-closed"),t("#fluidbox-overlay").fadeOut(),o.css({transform:"translate(0,0) scale(1)"}).one("webkitTransitionEnd MSTransitionEnd oTransitionEnd otransitionend transitionend",function(){o.css({opacity:0}),i.css({opacity:1})});else{t(this).data("fluidbox-state",1).removeClass("fluidbox-closed").addClass("fluidbox-opened"),t("#fluidbox-overlay").fadeIn(),o.css({"background-image":"url("+i.attr("src")+")",opacity:1}),i.css({opacity:0});var a=new Image;a.onload=function(){o.css({"background-image":"url("+n.attr("href")+")"})},a.src=t(this).attr("href"),s(t(this))}e.preventDefault()})}),o}}(jQuery),function(t){t.fn.randomPositionWithoutCollision=function(e){$bokehs=t("#bokehs");var n=t.extend({startOffsetX:0},e);return this.each(function(){$bokeh=t(this),$bokeh.css({left:randFromTo(0-$bokeh.width()/2,$bokehs.width()-$bokeh.width()/2)-n.startOffsetX,top:randFromTo(0-$bokeh.height()/2,$bokehs.height()-$bokeh.height()/2)}),$bokeh.siblings().not(".bokeh").each(function(){$sibling=t(this),isCollide($bokeh,$sibling,32)&&$bokeh.css("visibility","hidden")}),t(".bokehphobic").each(function(){$bp=t(this),isCollide($bokeh,$bp,32)&&$bokeh.css("visibility","hidden")})})}}(jQuery),$(function(){function t(){var t=randFromTo(u,d),e=randFromTo(c,l),n=randFromTo(f,p),i=$("#bokeh-box > .bokeh").eq(randFromTo(0,$("#bokeh-box > .bokeh").length)).clone();i.appendTo("#bokehs").randomPositionWithoutCollision({startOffsetX:n/2}).css({opacity:0}),TweenLite.to(i,t/1e3,{opacity:1,delay:.5*(t/1e3)}),TweenLite.to(i,t/1e3,{opacity:0,onComplete:function(){i.remove()},delay:(t+e)/1e3}),TweenLite.to(i,2*(t/1e3),{left:"+="+n,delay:e/1e3})}function e(){$("#bokehs").empty(),clearTimeout(o),clearTimeout(a),function e(){o=setTimeout(function(){t(),e()},randFromTo(r,s))}(),function n(){a=setTimeout(function(){t(),n()},randFromTo(r,s))}()}function n(t){h.after(h.clone().attr("id","clone")),$.pjax({url:t,container:"#main",fragment:"#main"})}function i(){$("#article p > img").addClass("img-responsive").wrap(function(){return'<a class="img-zoom" href="'+$(this).attr("src")+'"></a>'}),$(".img-zoom").fluidbox({viewportFill:.96,overlayColor:"rgba(255,255,255,.8)"})}$d=$(document);var o,a,r=480,s=3200,c=0,l=480,u=1120,d=3200,f=160,p=640;$(window).on("load",e);var h=$("#main"),m=$("body");$d.on("pjax:start",function(){h.css({opacity:0,"z-index":1}),m.css("overflow","hidden")}),$d.on("pjax:end",function(){e(),i(),TweenLite.to(h,.8,{opacity:1,onComplete:function(){$("#clone").remove(),h.css("z-index","auto"),m.css("overflow","auto")}}),h.find("#bokehs").length<1&&$("#cover").hasClass("invert")?$("#brand").addClass("invert"):$("#brand").removeClass("invert")}),$d.on("pjax:popstate",function(){h.after(h.clone().attr("id","clone")),h.css("opacity",0),$d.on("pjax:end",function(){$("#bokehs").empty()})}),$.support.pjax&&($d.on("click","#articles article",function(){n($(this).find("a").attr("href"))}),$d.on("click","#articles article h2 a",function(t){t.preventDefault(),n($(this).attr("href"))}),$d.on("click","#brand",function(t){t.preventDefault(),n($(this).attr("href"))})),i(),$d.on("click","#show-comments",function(){var t=$("#show-comments");TweenLite.to(t,.32,{opacity:0,onComplete:function(){t.remove();var e="aenism";$.ajax({type:"GET",url:"http://"+e+".disqus.com/embed.js",dataType:"script",cache:!0})}})})});