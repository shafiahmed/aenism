// copyright chris wanstrath
!function(e){function t(t,o,i){var r=this;return this.on("click.pjax",t,function(t){var a=e.extend({},d(o,i));a.container||(a.container=e(this).attr("data-pjax")||r),n(t,a)})}function n(t,n,o){o=d(n,o);var r=t.currentTarget;if("A"!==r.tagName.toUpperCase())throw"$.fn.pjax or $.pjax.click requires an anchor element";if(!(t.which>1||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey||location.protocol!==r.protocol||location.hostname!==r.hostname||r.hash&&r.href.replace(r.hash,"")===location.href.replace(location.hash,"")||r.href===location.href+"#")){var a={url:r.href,container:e(r).attr("data-pjax"),target:r},s=e.extend({},a,o),c=e.Event("pjax:click");e(r).trigger(c,[s]),c.isDefaultPrevented()||(i(s),t.preventDefault())}}function o(t,n,o){o=d(n,o);var r=t.currentTarget;if("FORM"!==r.tagName.toUpperCase())throw"$.pjax.submit requires a form element";var a={type:r.method.toUpperCase(),url:r.action,data:e(r).serializeArray(),container:e(r).attr("data-pjax"),target:r};i(e.extend({},a,o)),t.preventDefault()}function i(t){function n(t,n){var i=e.Event(t,{relatedTarget:o});return s.trigger(i,n),!i.isDefaultPrevented()}t=e.extend(!0,{},e.ajaxSettings,i.defaults,t),e.isFunction(t.url)&&(t.url=t.url());var o=t.target,r=u(t.url).hash,s=t.context=f(t.container);t.data||(t.data={}),t.data._pjax=s.selector;var c;t.beforeSend=function(e,o){return"GET"!==o.type&&(o.timeout=0),e.setRequestHeader("X-PJAX","true"),e.setRequestHeader("X-PJAX-Container",s.selector),n("pjax:beforeSend",[e,o])?(o.timeout>0&&(c=setTimeout(function(){n("pjax:timeout",[e,t])&&e.abort("timeout")},o.timeout),o.timeout=0),t.requestUrl=u(o.url).href,void 0):!1},t.complete=function(e,o){c&&clearTimeout(c),n("pjax:complete",[e,o,t]),n("pjax:end",[e,t])},t.error=function(e,o,i){var r=g("",e,t),s=n("pjax:error",[e,o,i,t]);"GET"==t.type&&"abort"!==o&&s&&a(r.url)},t.success=function(o,c,p){var d="function"==typeof e.pjax.defaults.version?e.pjax.defaults.version():e.pjax.defaults.version,f=p.getResponseHeader("X-PJAX-Version"),m=g(o,p,t);if(d&&f&&d!==f)return a(m.url),void 0;if(!m.contents)return a(m.url),void 0;i.state={id:t.id||l(),url:m.url,title:m.title,container:s.selector,fragment:t.fragment,timeout:t.timeout},(t.push||t.replace)&&window.history.replaceState(i.state,m.title,m.url),document.activeElement.blur(),m.title&&(document.title=m.title),s.html(m.contents);var h=s.find("input[autofocus], textarea[autofocus]").last()[0];if(h&&document.activeElement!==h&&h.focus(),v(m.scripts),"number"==typeof t.scrollTo&&e(window).scrollTop(t.scrollTo),""!==r){var w=u(m.url);w.hash=r,i.state.url=w.href,window.history.replaceState(i.state,m.title,w.href);var y=e(w.hash);y.length&&e(window).scrollTop(y.offset().top)}n("pjax:success",[o,c,p,t])},i.state||(i.state={id:l(),url:window.location.href,title:document.title,container:s.selector,fragment:t.fragment,timeout:t.timeout},window.history.replaceState(i.state,document.title));var d=i.xhr;d&&d.readyState<4&&(d.onreadystatechange=e.noop,d.abort()),i.options=t;var d=i.xhr=e.ajax(t);return d.readyState>0&&(t.push&&!t.replace&&(w(i.state.id,s.clone().contents()),window.history.pushState(null,"",p(t.requestUrl))),n("pjax:start",[d,t]),n("pjax:send",[d,t])),i.xhr}function r(t,n){var o={url:window.location.href,push:!1,replace:!0,scrollTo:!1};return i(e.extend(o,d(t,n)))}function a(e){window.history.replaceState(null,"","#"),window.location.replace(e)}function s(t){var n=t.state;if(n&&n.container){if(T&&j==n.url)return;if(i.state.id===n.id)return;var o=e(n.container);if(o.length){var r,s=k[n.id];i.state&&(r=i.state.id<n.id?"forward":"back",y(r,i.state.id,o.clone().contents()));var c=e.Event("pjax:popstate",{state:n,direction:r});o.trigger(c);var l={id:n.id,url:n.url,container:o,push:!1,fragment:n.fragment,timeout:n.timeout,scrollTo:!1};s?(o.trigger("pjax:start",[null,l]),n.title&&(document.title=n.title),o.html(s),i.state=n,o.trigger("pjax:end",[null,l])):i(l),o[0].offsetHeight}else a(location.href)}T=!1}function c(t){var n=e.isFunction(t.url)?t.url():t.url,o=t.type?t.type.toUpperCase():"GET",i=e("<form>",{method:"GET"===o?"GET":"POST",action:n,style:"display:none"});"GET"!==o&&"POST"!==o&&i.append(e("<input>",{type:"hidden",name:"_method",value:o.toLowerCase()}));var r=t.data;if("string"==typeof r)e.each(r.split("&"),function(t,n){var o=n.split("=");i.append(e("<input>",{type:"hidden",name:o[0],value:o[1]}))});else if("object"==typeof r)for(key in r)i.append(e("<input>",{type:"hidden",name:key,value:r[key]}));e(document.body).append(i),i.submit()}function l(){return(new Date).getTime()}function p(e){return e.replace(/\?_pjax=[^&]+&?/,"?").replace(/_pjax=[^&]+&?/,"").replace(/[\?&]$/,"")}function u(e){var t=document.createElement("a");return t.href=e,t}function d(t,n){return t&&n?n.container=t:n=e.isPlainObject(t)?t:{container:t},n.container&&(n.container=f(n.container)),n}function f(t){if(t=e(t),t.length){if(""!==t.selector&&t.context===document)return t;if(t.attr("id"))return e("#"+t.attr("id"));throw"cant get selector for pjax container!"}throw"no pjax container for "+t.selector}function m(e,t){return e.filter(t).add(e.find(t))}function h(t){return e.parseHTML(t,document,!0)}function g(t,n,o){var i={};if(i.url=p(n.getResponseHeader("X-PJAX-URL")||o.requestUrl),/<html/i.test(t))var r=e(h(t.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0])),a=e(h(t.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]));else var r=a=e(h(t));if(0===a.length)return i;if(i.title=m(r,"title").last().text(),o.fragment){if("body"===o.fragment)var s=a;else var s=m(a,o.fragment).first();s.length&&(i.contents=s.contents(),i.title||(i.title=s.attr("title")||s.data("title")))}else/<html/i.test(t)||(i.contents=a);return i.contents&&(i.contents=i.contents.not(function(){return e(this).is("title")}),i.contents.find("title").remove(),i.scripts=m(i.contents,"script[src]").remove(),i.contents=i.contents.not(i.scripts)),i.title&&(i.title=e.trim(i.title)),i}function v(t){if(t){var n=e("script[src]");t.each(function(){var t=this.src,o=n.filter(function(){return this.src===t});if(!o.length){var i=document.createElement("script");i.type=e(this).attr("type"),i.src=e(this).attr("src"),document.head.appendChild(i)}})}}function w(e,t){for(k[e]=t,E.push(e);S.length;)delete k[S.shift()];for(;E.length>i.defaults.maxCacheLength;)delete k[E.shift()]}function y(e,t,n){var o,i;k[t]=n,"forward"===e?(o=E,i=S):(o=S,i=E),o.push(t),(t=i.pop())&&delete k[t]}function x(){return e("meta").filter(function(){var t=e(this).attr("http-equiv");return t&&"X-PJAX-VERSION"===t.toUpperCase()}).attr("content")}function b(){e.fn.pjax=t,e.pjax=i,e.pjax.enable=e.noop,e.pjax.disable=C,e.pjax.click=n,e.pjax.submit=o,e.pjax.reload=r,e.pjax.defaults={timeout:650,push:!0,replace:!1,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20,version:x},e(window).on("popstate.pjax",s)}function C(){e.fn.pjax=function(){return this},e.pjax=c,e.pjax.enable=b,e.pjax.disable=e.noop,e.pjax.click=e.noop,e.pjax.submit=e.noop,e.pjax.reload=function(){window.location.reload()},e(window).off("popstate.pjax",s)}var T=!0,j=window.location.href,I=window.history.state;I&&I.container&&(i.state=I),"state"in window.history&&(T=!1);var k={},S=[],E=[];e.inArray("state",e.event.props)<0&&e.event.props.push("state"),e.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]|WebApps\/.+CFNetwork)/),e.support.pjax?b():C()}(jQuery);